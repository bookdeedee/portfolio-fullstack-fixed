// prisma/schema.prisma
generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

// -------------------- Projects --------------------
model Project {
  id            String  @id @default(cuid())
  title         String
  description   String? @db.Text
  imageDataUrl  String? @db.Text
  dateISO       String?
  // JSON string ของ string[] เช่น ["React","Node"]
  tagsText      String? @db.Text
  // JSON string ของลิงก์ [{label,url}]
  linksText     String? @db.Text
  // เปิด/ปิดการแสดงใน market
  marketEnabled Boolean @default(false)

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  @@index([marketEnabled])
}

// -------------------- Items (สินค้า) --------------------
model Item {
  id            String  @id @default(cuid())
  title         String
  description   String? @db.Text
  imageDataUrl  String? @db.Text
  dateISO       String?
  price         Float?
  // โหมดตลาดซื้อขาย
  marketEnabled Boolean @default(false)
  stock         Int     @default(0)

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  // ด้านตรงข้ามของ Order.item
  orders Order[]

  @@index([marketEnabled])
}

// -------------------- Orders (คำสั่งซื้อ) --------------------
model Order {
  id           String   @id @default(cuid())
  itemId       String
  item         Item     @relation(fields: [itemId], references: [id], onDelete: Cascade)
  qty          Int      @default(1)
  amount       Float? // ราคารวม (ถ้าไม่ใช้ปล่อยว่างได้)
  buyerName    String?
  buyerContact String?
  createdAt    DateTime @default(now())
  status       String   @default("new") // new, paid, canceled
  notes        String?  @db.Text

  @@index([itemId])
}
